generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model CentroMedico {
  id        Int        @id @default(autoincrement())
  nombre    String
  ciudad    String
  direccion String?
  consultas Consulta[]
  empleados Empleado[]
  medicos   Medico[]
  usuarios  Usuario[]

  @@map("centro_medico")
}

model Especialidad {
  id      Int      @id @default(autoincrement())
  nombre  String   @unique
  medicos Medico[]

  @@map("especialidad")
}

model Medico {
  id             Int          @id @default(autoincrement())
  nombres        String
  apellidos      String
  especialidadId Int          @map("id_especialidad")
  centroId       Int          @map("id_centro")
  consultas      Consulta[]
  centro         CentroMedico @relation(fields: [centroId], references: [id], onDelete: Cascade)
  especialidad   Especialidad @relation(fields: [especialidadId], references: [id], onDelete: Cascade)
  usuarios       Usuario[]

  @@index([centroId], map: "medico_id_centro_fkey")
  @@index([especialidadId], map: "medico_id_especialidad_fkey")
  @@map("medico")
}

model Empleado {
  id        Int          @id @default(autoincrement())
  nombres   String
  apellidos String
  cargo     String
  centroId  Int          @map("id_centro")
  centro    CentroMedico @relation(fields: [centroId], references: [id], onDelete: Cascade)

  @@index([centroId], map: "empleado_id_centro_fkey")
  @@map("empleado")
}

model Usuario {
  id           Int          @id @default(autoincrement())
  email        String       @unique
  passwordHash String       @map("password_hash")
  rol          Rol
  centroId     Int          @map("id_centro")
  medicoId     Int?         @map("id_medico")
  centro       CentroMedico @relation(fields: [centroId], references: [id], onDelete: Cascade)
  medico       Medico?      @relation(fields: [medicoId], references: [id])

  @@index([centroId], map: "usuario_id_centro_fkey")
  @@index([medicoId], map: "usuario_id_medico_fkey")
  @@map("usuario")
}

model Consulta {
  id          Int          @id @default(autoincrement())
  medicoId    Int          @map("id_medico")
  centroId    Int          @map("id_centro")
  paciente    String
  fechaHora   DateTime     @default(now()) @map("fecha_hora")
  motivo      String?
  diagnostico String?
  tratamiento String?
  costo       Decimal?
  centro      CentroMedico @relation(fields: [centroId], references: [id], onDelete: Cascade)
  medico      Medico       @relation(fields: [medicoId], references: [id], onDelete: Cascade)

  @@index([centroId], map: "consulta_id_centro_fkey")
  @@index([medicoId], map: "consulta_id_medico_fkey")
  @@map("consulta")
}

enum Rol {
  admin
  medico
}
