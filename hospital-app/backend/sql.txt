USE hospital_central;

-- Eliminar si existían
DROP TABLE IF EXISTS usuario;
DROP TABLE IF EXISTS medico;
DROP TABLE IF EXISTS empleado;
DROP TABLE IF EXISTS especialidad;
DROP TABLE IF EXISTS centro_medico;
DROP TABLE IF EXISTS consulta;

-- Tabla Centros Médicos
CREATE TABLE centro_medico (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(150) NOT NULL,
    ciudad VARCHAR(100) NOT NULL,
    direccion VARCHAR(200)
);

-- Tabla Especialidades
CREATE TABLE especialidad (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE
);

-- Tabla Médicos
CREATE TABLE medico (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombres VARCHAR(100) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    id_especialidad INT NOT NULL,
    id_centro INT NOT NULL,
    FOREIGN KEY (id_especialidad) REFERENCES especialidad(id) ON DELETE CASCADE,
    FOREIGN KEY (id_centro) REFERENCES centro_medico(id) ON DELETE CASCADE
);

-- Tabla Empleados
CREATE TABLE empleado (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombres VARCHAR(100) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    cargo VARCHAR(100) NOT NULL,
    id_centro INT NOT NULL,
    FOREIGN KEY (id_centro) REFERENCES centro_medico(id) ON DELETE CASCADE
);

-- Tabla Usuarios (para login)
CREATE TABLE usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(150) NOT NULL UNIQUE,
    password_hash TEXT NOT NULL,
    rol ENUM('admin','medico') NOT NULL,
    id_centro INT NOT NULL,
    id_medico INT,
    FOREIGN KEY (id_centro) REFERENCES centro_medico(id) ON DELETE CASCADE,
    FOREIGN KEY (id_medico) REFERENCES medico(id) ON DELETE SET NULL
);

-- Tabla Consultas Médicas
CREATE TABLE consulta (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_centro INT NOT NULL,
    id_medico INT NOT NULL,
    paciente_nombre VARCHAR(150) NOT NULL,
    fecha DATETIME NOT NULL,
    motivo TEXT,
    diagnostico TEXT,
    tratamiento TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_centro) REFERENCES centro_medico(id) ON DELETE CASCADE,
    FOREIGN KEY (id_medico) REFERENCES medico(id) ON DELETE CASCADE
);
